<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta name="renderer" content="webkit">
	<title>网阅星</title>
	<link rel="stylesheet" href="css/style.css">
	<link rel="stylesheet" href="css/user_information.css">
	<link rel="stylesheet" href="css/edit_paper.css">
	<!-- <link rel="stylesheet" href="http://cdn.staticfile.org/twitter-bootstrap/3.1.1/css/bootstrap.min.css"> -->
	<script type="text/javascript" src='js/jquery.min.js'></script>
	<script type="text/javascript" src='js/common.js'></script>
	<script type="text/javascript" src='js/client.js'></script>
	<script type="text/javascript" src='js/edit_paper.js'></script>
</head>
<body>
	<div id="wrap">
		<div id='header'>

		</div>

		<div class="user-title">
			<div class="user-title-back">
				<i class="iconfont">&#xe618;</i>
				当前位置：
				<a href="index">首页</a>
				>
				<a href="set_up">管理</a>
				>
				<span>编辑试卷</span>
			</div>
			
		</div>
		<div class="content-box">
			<div class="content edit-paper-cont">
				<div class="title">
					<a href="set_up" class="back"><i class="iconfont">&#xe61c;</i></a>
					<span>2017年10月青浦一中高三第一次模拟考</span>
					<span class="right mr20">总分：100分</span>
				</div>
				<div class="operation-box">
					<div class="op-btn right">
						<div class="determine set-item">题组设置</div>
						<div class="determine edit-save">编辑保存</div>
					</div>
				</div>
				<div class="item-group-box">
					<!-- <div class="item-title">一、单项选择题（共12分，每题2分）</div> -->
					<ul id="item-ul">
						
					</ul>
					<div class="pagination-wrap">
						<ul class="pagination" id="pagination"></ul>
					</div>
				</div>
				
				<!-- 弹出 -->
			<div class="sub_sz">
				<p class="sub_sz_p">题组设置<div class="sub_sz_p_div"><i class="iconfont" style="">&#xe61b;</i></div></p>
				<div class="sub_sz01" >
					<ul>
						<li>题型</li>
						<li>题号</li>
						<li>题组名称</li>
						<li>分值</li>
					</ul>
				</div>
				<div class="sub_sz02">
				<ul class="sub_sz_ul02">
					<li>
					<select>
						<option value="">选择题</option>	
					</select>
					
					<input type="" name="" value="一.">
                    <input type="" name="" value="一.单项选择题">
                    <input type="" name="" value="10">
                  
                    <i class="iconfont" data-id="0">&#xe622;</i>
                    <div style="width: 100%;height:89px;text-align:left;padding-left: 30px;box-sizing: border-box;display: none;">
                    <p style="padding-left: 113px;box-sizing: border-box;">
                    	<!-- <select name="">
                    		<option value="">单项选择题</option>
                    	</select> -->
                        <a style="">序号<input style="width: 25px;height: 25px;border-radius: 2px;border: 1px solid #ccc;margin-left: 5px;"></a>
                        <a style="margin-left: 20px;">选项个数<input style="width: 25px;height: 25px;border-radius: 2px;border: 1px solid #ccc;margin-left: 5px;"></a>
                        <a style="margin-left: 60px;">分值<input style="width: 25px;height: 25px;border-radius: 2px;border: 1px solid #ccc;margin-left: 5px;"></a>
                    	</p>
                    	<p style="padding-left: 113px;box-sizing: border-box;">
                    	<!-- <select name="">
                    		<option value="">多项选择题</option>
                    	</select> -->
                        <a style="">序号<input style="width: 25px;height: 25px;border-radius: 2px;border: 1px solid #ccc;margin-left: 5px;"></a>
                        <a style="margin-left: 20px;">选项个数<input style="width: 25px;height: 25px;border-radius: 2px;border: 1px solid #ccc;margin-left: 5px;"></a>
                        <a style="margin-left: 60px;">分值<input style="width: 25px;height: 25px;border-radius: 2px;border: 1px solid #ccc;margin-left: 5px;"></a>
                    	</p>
                    </div>
					</li>
                    <li>
					<select>
						<option value="">填空题</option>	
					</select>
					<input type="" name="" value="二.">
                    <input type="" name="" value="二.填空题">
                    <input type="" name="" value="10">
                    <i class="iconfont" data-id="0">&#xe622;</i>
                    <div style="width: 100%;height:50px;text-align:left;padding-left: 30px;box-sizing: border-box;display: none;">
                    	
                     <p>
                    	 <a style="margin-left: 10px;">序号<input style="width: 25px;height: 25px;border-radius: 2px;border: 1px solid #ccc;margin-left: 5px;"></a>
                        <a style="margin-left: 37px;">分值<input style="width: 25px;height: 25px;border-radius: 2px;border: 1px solid #ccc;margin-left: 5px;"></a>
                        <a style="margin-left: 30px;">序号<input style="width: 25px;height: 25px;border-radius: 2px;border: 1px solid #ccc;margin-left: 5px;"></a>
                        <a style="margin-left: 80px;">分值<input style="width: 25px;height: 25px;border-radius: 2px;border: 1px solid #ccc;margin-left: 5px;"></a>
                    	</p>
                    </div>
					</li>
                    <li >
					<select>
						<option value="">判断题</option>	
					</select>
					<input type="" name="" value="三.">
                    <input type="" name="" value="三.判断题">
                    <input type="" name="" value="20">
                    <i class="iconfont" data-id="0">&#xe622;</i>
                     <div style="width: 100%;height:50px;text-align:left;padding-left: 30px;box-sizing: border-box;display: none;">

                      <p>
                    	 <a style="margin-left: 10px;">序号<input style="width: 25px;height: 25px;border-radius: 2px;border: 1px solid #ccc;margin-left: 5px;"></a>
                        <a style="margin-left: 37px;">分值<input style="width: 25px;height: 25px;border-radius: 2px;border: 1px solid #ccc;margin-left: 5px;"></a>
                        <a style="margin-left: 30px;">序号<input style="width: 25px;height: 25px;border-radius: 2px;border: 1px solid #ccc;margin-left: 5px;"></a>
                        <a style="margin-left: 80px;">分值<input style="width: 25px;height: 25px;border-radius: 2px;border: 1px solid #ccc;margin-left: 5px;"></a>
                    	</p>
                     </div>
					</li>
                    <li>
					<select>
						<option value="">其他题</option>	
					</select>
					<input type="" name="" value="四.">
                    <input type="" name="" value="四.计算题">
                    <input type="" name="" value="20">
                    <i class="iconfont" data-id="0">&#xe622;</i>
                     <div style="width: 100%;height:50px;text-align:left;padding-left: 30px;box-sizing: border-box;display: none;">

                      <p>

                   	 <a style="margin-left: 10px;">序号<input style="width: 25px;height: 25px;border-radius: 2px;border: 1px solid #ccc;margin-left: 5px;"></a>
                        <a style="margin-left: 37px;">分值<input style="width: 25px;height: 25px;border-radius: 2px;border: 1px solid #ccc;margin-left: 5px;"></a>
                        <a style="margin-left: 30px;">序号<input style="width: 25px;height: 25px;border-radius: 2px;border: 1px solid #ccc;margin-left: 5px;"></a>
                        <a style="margin-left: 80px;">分值<input style="width: 25px;height: 25px;border-radius: 2px;border: 1px solid #ccc;margin-left: 5px;"></a>
                    	</p>
                     </div>
					</li>
                     <li>
					<select>
						<option value="">写作题</option>	
					</select>
					<input type="" name="" value="五.">
                    <input type="" name="" value="五.写作题">
                    <input type="" name="" value="40">
                    <i class="iconfont" data-id="0">&#xe622;</i>
                    <div style="width: 100%;height:auto;text-align:left;padding-left: 30px;box-sizing: border-box;display: none;">

                      <p>
                      <select name="">
                    		<option value="">方格</option>
                    	</select>
                    	 <a style="margin-left: 30px;">序号<input style="width: 25px;height: 25px;border-radius: 2px;border: 1px solid #ccc;margin-left: 5px;"></a>
                        <a style="margin-left: 30px;">格数<input style="width: 25px;height: 25px;border-radius: 2px;border: 1px solid #ccc;margin-left: 5px;"></a>
                        <a style="margin-left:80px;">分值<input style="width: 25px;height: 25px;border-radius: 2px;border: 1px solid #ccc;margin-left: 5px;"></a>
                    	</p>
                    	<p>
                      <select name="">
                    		<option value="">行线</option>
                    	</select>
                    	 <a style="margin-left: 30px;">序号<input style="width: 25px;height: 25px;border-radius: 2px;border: 1px solid #ccc;margin-left: 5px;"></a>
                        <a style="margin-left: 30px;">行数<input style="width: 25px;height: 25px;border-radius: 2px;border: 1px solid #ccc;margin-left: 5px;"></a>
                        <a style="margin-left:80px;">分值<input style="width: 25px;height: 25px;border-radius: 2px;border: 1px solid #ccc;margin-left: 5px;"></a>
                    	</p>
                    	<p>
                      <select name="">
                    		<option value="">方格</option>
                    	</select>
                    	 <a style="margin-left: 30px;">序号<input style="width: 25px;height: 25px;border-radius: 2px;border: 1px solid #ccc;margin-left: 5px;"></a>
                        <a style="margin-left:18px;">单词数<input style="width: 25px;height: 25px;border-radius: 2px;border: 1px solid #ccc;margin-left: 5px;"></a>
                        <a style="margin-left:80px;">分值<input style="width: 25px;height: 25px;border-radius: 2px;border: 1px solid #ccc;margin-left: 5px;"></a>
                    	</p>
                     </div>
					</li>
				</ul>
			 </div>
			 <div class="sub_sz03" style=""><a class="sub_top"><i class="iconfont">&#xe631;</i>上移</a>
			 <a class="sub_btm"><i class="iconfont">&#xe607;</i>下移</a>
			 <a class="sub_hide"><i class="iconfont">&#xe616;</i>删除</a>
			 </div>
			 <p class="sub_sz_p02"><button  class="sub_t determine" type="">确定</button><button class="sub_f">取消</button></p>
			 <div class="sub_sz_remove">
			 	<p>删除题组</p>
			 	<p>操作提示：</p>
			 	<p class="sub_sz_remove_p03">你确定要删除<a style="color: #31bc91"></a>题组嘛 ？</p>
			 	<p><i class="iconfont">&#xe63c;</i>删除后无法恢复</p>
			 	 <p><button class="sub_sz_remove_f">取消</button><button  class="sub_sz_remove_t determine" type="">确定</button></p>
			 	 <div class="sub_sz_remove_x"><i class="iconfont" style="">&#xe61b;</i></div>
			 </div>
			</div>
			<!-- 上下移 -->
			<script type="text/javascript">
				$(".sub_sz_ul02").on('click', 'li', function(event) {
					$(this).addClass('sub_li').siblings().removeClass('sub_li');
				});
				// 上移
				$(".sub_top").click(function(event) {
					var a=$(".sub_li").html();
					var b=$(".sub_li").prev().html();
					$(".sub_li").prev().html(a);
					$(".sub_li").html(b);
					$(".sub_li").prev().addClass('sub_li').siblings().removeClass('sub_li');
					
                    
				});
				// 下移
				$(".sub_btm").click(function(event) {
					var a=$(".sub_li").html();
					var b=$(".sub_li").next().html();
					$(".sub_li").next().html(a);
					$(".sub_li").html(b);
					$(".sub_li").next().addClass('sub_li').siblings().removeClass('sub_li');;
				});
				// 删除
				$(".sub_hide").click(function(event) {
					$(".sub_sz_remove").show();
					$(".sub_sz_remove_p03 a").html($(".sub_li input").eq(1).val());
					console.log($("#item-ul .items").length);

				});
				$(".sub_sz_remove_x").click(function(event) {
					$(".sub_sz_remove").hide();
				});
				$(".sub_sz_remove_t").click(function(event) {
					
					$(".sub_li").remove();
					$(".sub_sz_remove").hide();
				});
				$(".sub_sz_remove_f").click(function(event) {
					$(".sub_sz_remove").hide();
				});
				// 下拉
				$(".sub_sz_ul02").on('click', 'i', function(event) {
					
				// click(function(event) {
					
					if($(this).attr("data-id")==0){
					$(this).html('&#xe624;');	
					$(this).parent("li").addClass('sub_i_li');
					$(this).next('div').show();
					$(this).attr("data-id","1");
				}else{
					$(this).html('&#xe622;');	
					$(this).parent("li").removeClass('sub_i_li');
					$(this).next('div').hide();
					$(this).attr("data-id","0");
				}
				});
			</script>
			<div class="sub_bd">
				<p class="sub_bd_p" style="">绑定题组<div class="sub_bd_p_div" style=""><i class="iconfont" style="">&#xe61b;</i></div></p>
				<p class="sub_bd_p02">将本题绑定至指定题组</p>
				<div class="sub_bd02">
					<ul class="sub_bd02_ul01">
						<!-- <li><input value="一.单项选择题"></li> -->
						<!-- <li ><input value="二.填空题" ></li>
						<li><input value="三.判断题"></li>
						<li><input value="四.计算题" ></li> -->
						<!-- <li ><input value="五.写作"></li> -->
					</ul>
					<ul class="sub_bd02_ul02">
						<!-- <li><i class="iconfont" style="">&#xe64b;</i></li>
						<li><i class="iconfont" style="">&#xe64b;</i></li>
						<li ><i class="iconfont" style="">&#xe64b;</i></li>
						<li><i class="iconfont" style="">&#xe64b;</i></li>
						<li ><i class="iconfont" style="">&#xe64b;</i></li> -->
					</ul>

				</div>
				<div class="sub_bd03">
					<button  class="sub_bd_t determine" type="">确定</button>
					<button class="sub_bd_f">取消</button>
				</div>
			</div>
			<script>
				
			</script>
			<!-- 题组插入 -->
			<div class="title_in">
				<p class="title_in_p01">插入题组</p>
				<div class="title_in_div"><i class="iconfont">&#xe61b;</i></div>
                <p class="title_in_p02">试题题型
                <select name="">
                	<option data-id="0">选择题</option>
                	<option data-id="1">填空题</option>
                	<option data-id="2">判断题</option>
                	<option data-id="3">其他题</option>
                	<option data-id="4">写作题</option>
                </select></p>
                <p class="title_in_p03">题组名称<input type="" placeholder="请输入题组名称,如单项选择题" name=""></p>
                 <p class="title_in_p04"><button class="title_on determine" type="">确认添加</button><button type=""  class="title_off" >取消</button></p>
			</div>
			<!-- 题组插入end -->
			<!-- 设定分值 -->
			<div class="score_change">
				<p class="score_change_p01">设定分值</p>
                <div class="score_change_div"><i class="iconfont">&#xe61b;</i></div>
                <p class="score_change_p03">分值<input type="" placeholder=""></p>
                 <p class="score_change_p04"><button class="score_change_on determine" type="">保存</button><button type=""  class="score_change_off" >取消</button></p>
			</div>
			<!-- 设定分值end -->
			<!-- 删除题目 -->
			<div class="list_remover">
				<p class="list_remover_p01">删除题目</p>
                 <p class="list_remover_p02">删除后无法恢复，你确定删除吗？</p>
                 <p class="list_remover_p04"><button class="list_remover_on determine" type="">删除</button><button type=""  class="list_remover_off" >取消</button></p>
			</div>
			<!-- 删除题目end -->
			</div>
			
		</div>
		<script type="text/javascript">
$("#item-ul").on('mouseup', 'p', function() {
 get_sel_range();

});
  $(function(){

    // 分割题目
    var slipt_up=$('.item-seg');
    $(document).on('click', '.item-seg',function() {
      

      if (sel_range == null){
        alert('分割位置错误');
        return;
      }
      else{
        var pos = sel_range;
        var focusnode=sel_range.endContainer;
        var $node = $(focusnode);
        var parent = $node.parents('.editor-enabled');
        if (!parent) {
          alert('请将光标放置在正确分割位置');
          return;
        }
          // console.log(focusnode);
        var range = sel_range;
        var tmp = document.createRange();
        tmp.setEnd(range.startContainer,range.startOffset);
        tmp.setStartBefore(parent[0].childNodes[0]);
        var rect1 = tmp.getBoundingClientRect();
        range.setEndAfter(parent[0].childNodes[parent[0].childNodes.length-1]);
        var rect = range.getBoundingClientRect();
        if (rect.width==0 || rect.height==0 || rect1.width==0 || rect1.height==0) {
          alert('分割题目位置错误');
          return;
        }
        var newnode = range.extractContents();
        var div = document.createElement('div');
        div.appendChild(newnode);
        var content = div.innerHTML;
        var nc = parent[0].innerHTML;
        nc = retriveImg(nc);
        var newitem=$(this).parents('.items').clone();
        newitem.children('div').children().remove();
        newitem.children('div').append(content);
        $(this).parents('.items').after(newitem);
       
       var old_word = $(this).parents('.items').find('.editor-enabled p');
       var new_word = $(this).parents('.items').next().find('.editor-enabled p');
       var old_ary = [];
       var nw_ary = [];

       for (var i = 0; i <old_word.length; i++) {
          if($(old_word[i]).html().trim().length > 0){
               old_ary.push($(old_word[i]).html());
          }

       };
      for (var i = 0; i <new_word.length; i++) {
        if($(new_word[i]).html().trim().length > 0){
          nw_ary.push($(new_word[i]).html());
        }
       //list_number
       console.log($("#item-ul .items").length);
       var a =$("#item-ul .items").length-1;
       
     //    for(var i=0;i<a;i++){
     //   var nub=i+1;
     //   $("#item-ul .items").eq(i).find('.item-edit').attr("data-a",i);
     //  $("#item-ul .items").eq(i).find('.list_nub').html(''+nub+'.');
     // }
     //
       };
      }
    });
  });



  var sel_range=null;
  function get_sel_range() {
    if (window.getSelection) {
     sel_range = window.getSelection().getRangeAt(0);
    }else if (document.selection && document.selection.type != "Control") {
      sel_range = document.selection.createRange();
    }
  }
    var browser = {
    chrome: navigator.userAgent.match(/chrome/i) ? true : false,
    safari: navigator.userAgent.match(/safari/i) && !navigator.userAgent.match(/chrome/i) ? true : false,
    firefox: navigator.userAgent.match(/firefox/i) ? true : false,
    opera: navigator.userAgent.match(/opera/i) ? true : false,
    ie: navigator.userAgent.match(/msie|trident\/.*rv:/i) ? true : false,
    webkit: navigator.userAgent.match(/webkit/i) ? true : false,
    ieVersion: function() {
      var rv = -1; // Return value assumes failure.
      var ua = navigator.userAgent;
      var re  = new RegExp("(MSIE |rv:)([0-9]{1,}[\.0-9]{0,})");
      if (re.exec(ua) !== null) {
        rv = parseFloat(RegExp.$2);
      }
      return rv;
    }
  };

  var ieLtIE8 = function() {
    return browser.ie && browser.ieVersion() < 8;
  }

  var ieLtIE9 = function() {
    return browser.ie && browser.ieVersion() < 9;
  }

  
  var retriveImg = function(html) {
    return html.replace(/\/web1\/ckupload\/quessIImage/gi, 'quessIImage');
  }




</script>

		<div id="footer">

		</div>
		<!-- 遮罩层 -->
    <div class="layer"></div>
	</div>
</body>
</html>